from bs4 import BeautifulSoup as bs

SCRIPT = '''
        hacked = function() {
            alert('hacked');
        }
        window.addEventListener('load', 
          function() { 
            var f = document.querySelector("form");
            f.setAttribute("onsubmit", "hacked()");
          },
          false
        );'''


def get_text_by_class(soup, tag: str, class_name: str) -> str:
    return soup.find(tag, {"class": class_name}).text


def change_tag_string(soup, tag, new_srting) -> bs:
    tag.string = new_srting
    return soup


def make_soup(file_path: str) -> bs:
    with open(file_path) as fp:
        soup = bs(fp, 'html.parser')
    return soup


def add_new_tag(soup, original_tag, new_tag_name, new_tag_string):
    new_tag = soup.new_tag(new_tag_name)
    new_tag.string = new_tag_string
    original_tag.insert_before(new_tag)
    return soup


if __name__ == '__main__':
    soup = make_soup('../../materials/evilcorp.html')
    change_tag_string(soup, soup.title, 'Evil Corp - Stealing your money every day')
    add_new_tag(soup, soup.body.p, "h1", get_text_by_class(soup, "span", "name") + ", you are hacked!")
    add_new_tag(soup, soup.head.title, "script", SCRIPT)
    soup.a['href'] = "https://mrrobot.fandom.com/wiki/Fsociety"
    change_tag_string(soup, soup.a, "Fsociety")
    with open('../../materials/evilcorp_hacked.html', "w") as fp:
        fp.write(str(soup))
